# 微信小程序网络配置指南

## 问题描述
实机测试时出现网络连接失败错误，主要原因是域名白名单配置问题。

## 解决方案

### 1. 微信公众平台域名配置

#### 步骤1：登录微信公众平台
1. 访问 https://mp.weixin.qq.com/
2. 使用小程序管理员账号登录

#### 步骤2：配置服务器域名
1. 进入"开发" -> "开发管理" -> "开发设置"
2. 找到"服务器域名"配置区域
3. 在"request合法域名"中添加：
   ```
   https://wxmall.shop
   ```
4. 点击"保存"按钮

#### 步骤3：配置业务域名（可选）
如果需要在小程序内打开网页，还需要配置：
```
https://wxmall.shop
```

### 2. 域名要求

#### HTTPS要求
- 域名必须支持HTTPS协议
- 证书必须有效且不被浏览器拦截

#### 备案要求
- 域名必须已备案（中国大陆要求）
- 备案信息必须真实有效

#### 端口要求
- 只能使用80和443端口
- 不支持自定义端口

### 3. 常见问题排查

#### 问题1：域名未配置
**错误信息**：`request:fail url not in domain list`
**解决方案**：在微信公众平台添加域名到白名单

#### 问题2：HTTPS证书问题
**错误信息**：`request:fail ssl handshake error`
**解决方案**：
1. 检查域名SSL证书是否有效
2. 确保证书链完整
3. 检查证书是否过期

#### 问题3：网络超时
**错误信息**：`request:fail timeout`
**解决方案**：
1. 检查网络连接
2. 增加请求超时时间
3. 检查服务器响应速度

#### 问题4：域名解析失败
**错误信息**：`request:fail dns error`
**解决方案**：
1. 检查域名DNS解析
2. 确认域名拼写正确
3. 尝试使用IP地址（不推荐）

### 4. 开发环境配置

#### 微信开发者工具设置
1. 打开微信开发者工具
2. 进入"详情" -> "本地设置"
3. 勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"

**注意**：此设置仅用于开发调试，正式发布时必须配置正确的域名白名单。

### 5. 测试方法

#### 方法1：使用小程序内置诊断
1. 在小程序首页点击"网络诊断"按钮
2. 查看诊断结果和建议

#### 方法2：手动测试
1. 在浏览器中访问：`https://wxmall.shop/api/mall/home`
2. 确认返回JSON数据而不是错误页面

#### 方法3：使用Postman测试
1. 创建GET请求
2. URL：`https://wxmall.shop/api/mall/home`
3. 发送请求并检查响应

### 6. 部署检查清单

- [ ] 域名已添加到微信公众平台白名单
- [ ] 域名支持HTTPS协议
- [ ] SSL证书有效且未过期
- [ ] 域名已备案（中国大陆）
- [ ] 服务器正常运行
- [ ] API接口返回正确数据
- [ ] 网络请求超时设置合理

### 7. 联系支持

如果按照以上步骤配置后仍有问题，请：

1. 检查微信公众平台域名配置状态
2. 使用小程序内置网络诊断功能
3. 查看控制台错误日志
4. 联系技术支持

## 注意事项

1. **域名配置生效时间**：配置后可能需要几分钟到几小时生效
2. **开发环境**：开发时可以使用"不校验合法域名"选项
3. **正式环境**：必须配置正确的域名白名单
4. **HTTPS要求**：微信小程序要求所有网络请求必须使用HTTPS
5. **备案要求**：中国大陆的域名必须备案才能正常使用 